$.sdekint=$.sdekint||{},$.extend($.sdekint,{Dialog:function(i){this.$wrapper=$(i.html),this.$block=!1,this.is_full_screen=this.$wrapper.hasClass("is-full-screen"),this.is_full_screen&&(this.$block=this.$wrapper.find(".sdekint-dialog-block")),this.position=i.position||!1,this.is_closed=!1,this.userPosition=i.setPosition||!1,this.onBgClick=i.onBgClick||!1,this.onOpen=i.onOpen||function(){},this.onClose=i.onClose||function(){},this.onRefresh=i.onRefresh||!1,this.onResize=i.onResize||!1,this.canBeClosed=i.canBeClosed||function(){return!0},this.initClass=function(){this.$wrapper.data("sdekintDialog",this),this.show(),this.bindEvents()},this.bindEvents=function(){var i=$(document),t=this.$block?this.$block:this.$wrapper,s=function(){if(!this.is_closed&&this.canBeClosed())this.close();else if(!this.canBeClosed())return;i.off("click",s),i.off("wa_before_load",s)}.bind(this),e=function(){$.contains(document,this.$wrapper[0])?this.resize():$(window).off("resize",e)}.bind(this);setTimeout(function(){i.on("click",s).on("wa_before_load",s),this.$wrapper.on("close",s),this.is_full_screen&&this.$wrapper.on("click",".sdekint-dialog-background",function(i){this.onBgClick?this.onBgClick(i):i.stopPropagation()}.bind(this)),t.on("click",function(i){i.stopPropagation()}),i.on("keyup",function(i){27===i.keyCode&&this.close()}.bind(this)),t.on("click",".js-close-dialog",function(){s()}),this.is_full_screen&&$(window).on("resize",e)}.bind(this),0)},this.show=function(){$("body").append(this.$wrapper),this.setPosition(),this.onOpen(this.$wrapper,this)},this.setPosition=function(i){var t,s=$(window),e=s.width(),n=this.is_full_screen?s.height():$(document).height(),o=this.$block?this.$block:this.$wrapper,h=i&&i.width?i.width:o.outerWidth(),r=i&&i.height?i.height:o.outerHeight();this.position?t=this.position:t=(this.userPosition?this.userPosition:function(i){return{left:Math.ceil((parseInt((""+e).trim())-parseInt((""+i.width).trim()))/2),top:Math.ceil((parseInt((""+n).trim())-parseInt((""+i.height).trim()))/2)}})({width:h,height:r});if(0<t.left&&t.left+h>e&&(t.left=e-h-10),0<t.top)t.top+r>n&&(t.top=n-r-10);else if(t.top=10,this.is_full_screen){var c=o.find(".sdekint-dialog-content");c.hide();var l=o.outerHeight(),a=n-l-20;c.height(a).addClass("is-long-content").show()}return i?$.extend(t,{width:i.width+"px",height:i.height+"px"}):$.extend(t,{width:o.css("width"),height:o.css("height")}),o.css(t),this},this.close=function(){this.canBeClosed()&&(this.is_closed=!0,this.$wrapper.remove(),this.onClose(this.$wrapper,this))},this.refresh=function(){this.onRefresh&&(this.onRefresh(),this.close())},this.resize=function(i){this.$block.addClass("is-animated"),this.setPosition(i),this.onResize&&this.onResize(this.$wrapper,this)},this.initClass()}}),$.sdekint=$.extend($.sdekint,{LongAction:function(i){var s,e,n,o,h,t,r,c,l="",a="",d=500,p=750,f=[],u={},w=null,g=!1,k=function(){for(;0<f.length;){var i=f.shift();i&&clearTimeout(i)}},_=function(i){if(!g){i=i||d;var t=setTimeout(function(){var i=$.extend(!0,{},u);i.processId=a,$.post(l,i,function(i){var t;i?i.ready?(e&&e.call(w,i),(t=$.extend(!0,{},u)).processId=a,t.cleanup=1,$.post(l,t,function(i){s&&s(i)}).always(function(){k()})):i.error?o&&o.call(w,i):i.progress?(n&&n.call(w,i),_()):i.warning?(h&&h.call(w,i),_()):_(p):_(p),c&&c.call(w,i)},"json").error(function(){_(p)})},i);f.push(t)}};if(this.start=function(){t&&t();var i=$.extend(!0,{},u);$.post(l,i,function(i){i&&i.processId?(a=i.processId,_(100),_(200)):i&&i.error?o&&o.call(w,i):o&&o.call(w,"Server error")},"json").error(function(){o&&o.call(w,"Server error")})}.bind(this),this.stop=function(){g=!0,r&&r.call(w),k()}.bind(this),!i.url)throw new Error("Url is required");l=i.url,d=i.step_delay||d,p=i.rest_delay||p,u=i.post_data||u,s=i.onCleanup,e=i.onReady,n=i.onProgress,o=i.onError,h=i.onWarning,t=i.onStart,r=i.onStop,c=i.onAlways,w=this}});
(function(a){a.Vkshop={product:null,product_id:null,app_id:null,init:function(b){var c=this;a.extend(c,b);a("#vkshop-product-images").imagepicker({limit:5})},prepare:function(c){var d=this;var b=a("#vkshop-product-images");if(!b.val()){return false}a('<div id="s-plugin-vkshop-dialog"></div>').waDialog({width:"720px",height:"530px",url:"?plugin=vkshop&action=dialog&product_id="+c+"&images[]="+b.val().join("&images[]="),onLoad:function(){var e=this;a(".dialog-buttons",this).on("click","button.green",function(){var f=a("#s-plugin-vkshop-posting-in-process"),g=a(":input",a(e));g.prop("disabled",true);f.show();a.post("?plugin=vkshop&action=send",a.param({data:{product_id:c,images:b.val(),caption:a("textarea","#s-plugin-vkshop-cropimage-description").val(),name:a("input","#s-plugin-vkshop-vk-name").val(),price:a("input","#s-plugin-vkshop-vk-price").val(),vk_cat_id:a("select","#s-plugin-vkshop-vk-cat").val(),vk_album_id:a("select","#s-plugin-vkshop-vk-album").val(),vk_new_album:a("input","#s-plugin-vkshop-vk-new-album").val(),group_id:a("#s-plugin-vkshop-vk-group_id").val()}})).done(function(h){if(h.status&&h.status=="ok"){a(e).trigger("close")}else{var j="";for(var i in h.errors){if(h.errors[i]){j+=h.errors[i]}}a("#s-plugin-vkshop-error").html(j)}}).always(function(){f.hide();g.prop("disabled",false)})})},onClose:function(){a("#s-plugin-vkshop-dialog").remove()}})},disable:function(){var b=a.product_list.getSelectedProducts();if(!b.count){alert($_("Please select at least one product"));return false}a.post("?plugin=vkshop&action=disable",{products:b,action:"disable"},function(e){if(e.status==="ok"){var c=a("#product-list");c.find(".s-select-all:first").trigger("select",false);a("form").find("input:checked").attr("checked",false);a("#vkshop-disabled").html(e.data.disabled);a("#vkshop-queued").html(e.data.queued)}},"json")},undisable:function(){var b=a.product_list.getSelectedProducts();if(!b.count){alert($_("Please select at least one product"));return false}a.post("?plugin=vkshop&action=disable",{products:b,action:"undisable"},function(e){if(e.status==="ok"){var c=a("#product-list");c.find(".s-select-all:first").trigger("select",false);a("form").find("input:checked").attr("checked",false);a("#vkshop-disabled").html(e.data.disabled);a("#vkshop-queued").html(e.data.queued)}},"json")},queue:function(){var b=a.product_list.getSelectedProducts();if(!b.count){alert($_("Please select at least one product"));return false}a.post("?plugin=vkshop&action=queue",{products:b},function(e){if(e.status==="ok"){var c=a("#product-list");c.find(".s-select-all:first").trigger("select",false);a("form").find("input:checked").attr("checked",false);a("#vkshop-disabled").html(e.data.disabled);a("#vkshop-queued").html(e.data.queued)}},"json")},clearqueue:function(){a.post("?plugin=vkshop&action=clearqueue",function(c){if(c.status==="ok"){var b=a("#product-list");b.find(".s-select-all:first").trigger("select",false);a("form").find("input:checked").attr("checked",false);a("#vkshop-disabled").html(c.data.disabled);a("#vkshop-queued").html(c.data.queued)}},"json")},groupselect:function(c){var b=a(c).val();a.post("?plugin=vkshop&action=getalbums",{group_id:b},function(e){if(e.status==="ok"){a("#vkshop-albums").html(e.data.albums)}},"json")}}})(jQuery);